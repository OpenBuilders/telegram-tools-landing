import cn from 'classnames';
import { useEffect, useState } from 'react';

import { useToast } from './Toast';
import styles from './Toast.module.scss';

export interface ToastOptions {
  message: string;
  time?: number;
  type?: 'success' | 'error' | 'loading' | 'copy' | 'subscribe' | 'unsubscribe';
}

export const ToastElement = ({
  children,
  id,
  options,
}: {
  options: ToastOptions;
  id: string | number;
  children: React.ReactNode;
}) => {
  const { time, type } = options;
  const timeToClose = time ? time : 4000;

  const { hideToast } = useToast();
  const [isOpen, setIsOpen] = useState(false);

  useEffect(() => {
    const timer = setTimeout(() => {
      hideToast(id);
    }, timeToClose + 1000);

    const hideTimer = setTimeout(() => {
      setIsOpen(false);
    }, timeToClose);

    return () => {
      clearTimeout(timer);
      clearTimeout(hideTimer);
    };
  }, [id, hideToast]);

  useEffect(() => {
    setTimeout(() => {
      setIsOpen(true);
    }, 50);
  }, []);

  return (
    <div className={styles.toast} key={id}>
      <div
        className={cn(
          styles.toastContentWrapper,
          isOpen && styles.toastOpened,
          styles[`type-${type ? type : 'success'}`],
        )}
      >
        <div className={styles.toastContent}>
          {!type || type === 'success' ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M14 25C20.0751 25 25 20.0751 25 14C25 7.92487 20.0751 3 14 3C7.92487 3 3 7.92487 3 14C3 20.0751 7.92487 25 14 25ZM19.1826 9.91716C19.413 9.54016 19.2942 9.04777 18.9172 8.81737C18.5402 8.58698 18.0478 8.70584 17.8174 9.08284L12.8851 17.1538L10.1021 13.9732C9.81112 13.6407 9.30571 13.607 8.9732 13.8979C8.64069 14.1889 8.60699 14.6943 8.89794 15.0268L12.3979 19.0268C12.5656 19.2184 12.8144 19.3188 13.068 19.2971C13.3217 19.2755 13.5499 19.1344 13.6826 18.9172L19.1826 9.91716Z"
                fill="white"
              />
            </svg>
          ) : null}
          {type === 'loading' ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
            >
              <path
                d="M9.75455 15.1698H13.9914C14.2042 15.1698 14.3826 15.0978 14.5264 14.954C14.6702 14.8101 14.7421 14.6317 14.7421 14.4187V8.89353C14.7421 8.68058 14.6702 8.50216 14.5264 8.35827C14.3826 8.21439 14.2042 8.14245 13.9914 8.14245C13.7843 8.14245 13.6088 8.21439 13.465 8.35827C13.3212 8.50216 13.2493 8.68058 13.2493 8.89353V13.6763H9.75455C9.54171 13.6763 9.3605 13.7482 9.21093 13.8921C9.06711 14.036 8.99521 14.2115 8.99521 14.4187C8.99521 14.6317 9.06711 14.8101 9.21093 14.954C9.3605 15.0978 9.54171 15.1698 9.75455 15.1698ZM14 23C12.7689 23 11.6098 22.764 10.5225 22.2921C9.43528 21.8259 8.47747 21.1784 7.64909 20.3496C6.82071 19.5209 6.17066 18.5655 5.69895 17.4835C5.23298 16.3957 5 15.2331 5 13.9957C5 12.764 5.23298 11.6072 5.69895 10.5252C6.17066 9.43741 6.81783 8.47914 7.64046 7.65036C8.46884 6.82158 9.42665 6.1741 10.5139 5.70791C11.6012 5.23597 12.7603 5 13.9914 5C15.2224 5 16.3816 5.23597 17.4688 5.70791C18.5618 6.1741 19.5197 6.82158 20.3423 7.65036C21.1707 8.47914 21.8207 9.43741 22.2924 10.5252C22.7641 11.6072 23 12.764 23 13.9957C23 15.2331 22.7641 16.3957 22.2924 17.4835C21.8207 18.5655 21.1707 19.5209 20.3423 20.3496C19.5197 21.1784 18.5647 21.8259 17.4775 22.2921C16.3902 22.764 15.2311 23 14 23Z"
                fill="white"
              />
            </svg>
          ) : null}
          {type === 'error' ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
            >
              <path
                d="M14 23C12.7689 23 11.6098 22.764 10.5225 22.2921C9.43528 21.8259 8.47747 21.1784 7.64909 20.3496C6.82071 19.5209 6.17066 18.5655 5.69895 17.4835C5.23298 16.3957 5 15.2331 5 13.9957C5 12.764 5.23298 11.6072 5.69895 10.5252C6.17066 9.43741 6.81783 8.47914 7.64046 7.65036C8.46884 6.82158 9.42665 6.1741 10.5139 5.70791C11.6012 5.23597 12.7603 5 13.9914 5C15.2224 5 16.3816 5.23597 17.4688 5.70791C18.5618 6.1741 19.5197 6.82158 20.3423 7.65036C21.1707 8.47914 21.8207 9.43741 22.2924 10.5252C22.7641 11.6072 23 12.764 23 13.9957C23 15.2331 22.7641 16.3957 22.2924 17.4835C21.8207 18.5655 21.1707 19.5209 20.3423 20.3496C19.5197 21.1784 18.5647 21.8259 17.4775 22.2921C16.3902 22.764 15.2311 23 14 23ZM14 15.4029C14.5523 15.4029 14.8399 15.1151 14.8629 14.5396L15.001 10.4561C15.0125 10.1741 14.9204 9.94101 14.7248 9.75683C14.535 9.56691 14.2905 9.47194 13.9914 9.47194C13.6865 9.47194 13.4391 9.56403 13.2493 9.7482C13.0594 9.93237 12.9703 10.1683 12.9818 10.4561L13.1112 14.5396C13.1342 15.1151 13.4305 15.4029 14 15.4029ZM14 18.4417C14.3106 18.4417 14.5753 18.3468 14.7939 18.1568C15.0125 17.9612 15.1218 17.7108 15.1218 17.4058C15.1218 17.1065 15.0125 16.859 14.7939 16.6633C14.5753 16.4676 14.3106 16.3698 14 16.3698C13.6836 16.3698 13.4161 16.4676 13.1975 16.6633C12.9789 16.859 12.8696 17.1065 12.8696 17.4058C12.8696 17.7108 12.9789 17.9612 13.1975 18.1568C13.4219 18.3468 13.6894 18.4417 14 18.4417Z"
                fill="white"
              />
            </svg>
          ) : null}
          {type === 'copy' ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M5.68969 18.3173C6.14933 18.7761 6.8277 19.0054 7.72481 19.0054H9.13651V20.2728C9.13651 21.1734 9.36633 21.8532 9.82596 22.3119C10.2856 22.7706 10.964 23 11.8611 23H20.2757C21.1728 23 21.8512 22.7678 22.3108 22.3035C22.7704 21.8448 23.0002 21.1679 23.0002 20.2728V11.7134C23.0002 10.8239 22.7704 10.147 22.3108 9.68268C21.8512 9.21835 21.1728 8.98618 20.2757 8.98618H18.864V7.72724C18.864 6.83215 18.6342 6.15523 18.1745 5.6965C17.7149 5.23217 17.0365 5 16.1394 5H7.72481C6.8277 5 6.14933 5.22937 5.68969 5.6881C5.23006 6.14684 5.00024 6.82655 5.00024 7.72724V16.2782C5.00024 17.1789 5.23006 17.8586 5.68969 18.3173ZM17.2276 8.98618V7.8699C17.2276 7.46151 17.1251 7.15662 16.9202 6.95522C16.7153 6.74823 16.4218 6.64474 16.0397 6.64474H7.82449C7.43685 6.64474 7.14058 6.74823 6.93568 6.95522C6.73633 7.15662 6.63665 7.46151 6.63665 7.8699V16.1355C6.63665 16.5439 6.73633 16.8516 6.93568 17.0586C7.14058 17.26 7.43685 17.3607 7.82449 17.3607H9.13651V11.7134C9.13651 10.8183 9.36633 10.1414 9.82596 9.68268C10.2856 9.21835 10.964 8.98618 11.8611 8.98618H17.2276ZM20.176 21.3553H11.9608C11.5731 21.3553 11.2768 21.2518 11.072 21.0448C10.8671 20.8434 10.7646 20.5385 10.7646 20.1301V11.8645C10.7646 11.4561 10.8671 11.1512 11.072 10.9498C11.2768 10.7428 11.5731 10.6393 11.9608 10.6393H20.176C20.5581 10.6393 20.8516 10.7428 21.0565 10.9498C21.2614 11.1512 21.3638 11.4561 21.3638 11.8645V20.1301C21.3638 20.5385 21.2614 20.8434 21.0565 21.0448C20.8516 21.2518 20.5581 21.3553 20.176 21.3553Z"
                fill="white"
              />
            </svg>
          ) : null}
          {type === 'subscribe' ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
            >
              <path
                d="M5.86865 20.7822C5.3833 20.7822 5.00391 20.6694 4.73047 20.4438C4.45703 20.2183 4.32031 19.9175 4.32031 19.5415C4.32031 19.1997 4.41943 18.8682 4.61768 18.5469C4.81592 18.2256 5.06201 17.9111 5.35596 17.6035C5.65674 17.2959 5.9541 16.9883 6.24805 16.6807C6.47363 16.4482 6.64795 16.144 6.771 15.7681C6.90088 15.3921 6.99658 14.9922 7.05811 14.5684C7.11963 14.1445 7.16406 13.7344 7.19141 13.3379C7.21191 12.0254 7.35205 10.8564 7.61182 9.83105C7.87158 8.80566 8.27832 7.94434 8.83203 7.24707C9.39258 6.5498 10.1274 6.03711 11.0366 5.70898C11.228 5.03906 11.5801 4.47168 12.0928 4.00684C12.6055 3.54199 13.2378 3.30957 13.9897 3.30957C14.7485 3.30957 15.3843 3.54199 15.897 4.00684C16.4097 4.47168 16.7617 5.03906 16.9531 5.70898C17.8623 6.03711 18.5938 6.5498 19.1475 7.24707C19.7012 7.94434 20.1079 8.80566 20.3677 9.83105C20.6343 10.8564 20.7778 12.0254 20.7983 13.3379C20.8257 13.7344 20.8701 14.1445 20.9316 14.5684C20.9932 14.9922 21.0854 15.3921 21.2085 15.7681C21.3384 16.144 21.5161 16.4482 21.7417 16.6807C22.0356 16.9883 22.3296 17.2959 22.6235 17.6035C22.9243 17.9111 23.1738 18.2256 23.3721 18.5469C23.5703 18.8682 23.6694 19.1997 23.6694 19.5415C23.6694 19.9175 23.5327 20.2183 23.2593 20.4438C22.9858 20.6694 22.6064 20.7822 22.1211 20.7822H5.86865ZM13.9897 24.894C13.4155 24.894 12.8994 24.7676 12.4414 24.5146C11.9834 24.2617 11.6143 23.9302 11.334 23.52C11.0537 23.1099 10.8931 22.6655 10.8521 22.187H17.1377C17.0898 22.6655 16.9258 23.1099 16.6455 23.52C16.3721 23.9302 16.0063 24.2617 15.5483 24.5146C15.0903 24.7676 14.5708 24.894 13.9897 24.894Z"
                fill="white"
              />
            </svg>
          ) : null}
          {type === 'unsubscribe' ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="28"
              height="28"
              viewBox="0 0 28 28"
              fill="none"
            >
              <path
                d="M13.9795 24.894C13.3984 24.894 12.8789 24.7676 12.4209 24.5146C11.9629 24.2617 11.5938 23.9302 11.3135 23.52C11.04 23.1099 10.8794 22.6655 10.8315 22.187H17.1274C17.0796 22.6655 16.9155 23.1099 16.6353 23.52C16.355 23.9302 15.9858 24.2617 15.5278 24.5146C15.0767 24.7676 14.5605 24.894 13.9795 24.894ZM5.84814 20.7822C5.36279 20.7822 4.9834 20.6694 4.70996 20.4438C4.43652 20.2183 4.2998 19.9175 4.2998 19.5415C4.2998 19.1997 4.39893 18.8682 4.59717 18.5469C4.79541 18.2256 5.0415 17.9111 5.33545 17.6035C5.63623 17.2959 5.93701 16.9883 6.23779 16.6807C6.46338 16.4482 6.6377 16.144 6.76074 15.7681C6.89062 15.3921 6.98291 14.9922 7.0376 14.5684C7.09912 14.1445 7.14355 13.7344 7.1709 13.3379C7.17773 12.7363 7.2085 12.1655 7.26318 11.6255C7.32471 11.0786 7.41357 10.5625 7.52979 10.0771L18.2246 20.7822H5.84814ZM13.9795 3.30957C14.7314 3.30957 15.3638 3.54199 15.8765 4.00684C16.3892 4.47168 16.7446 5.03906 16.9429 5.70898C17.8521 6.03711 18.5835 6.5498 19.1372 7.24707C19.6909 7.94434 20.0977 8.80566 20.3574 9.83105C20.6172 10.8564 20.7607 12.0254 20.7881 13.3379C20.8086 13.7344 20.8496 14.1445 20.9111 14.5684C20.9727 14.9922 21.0649 15.3921 21.188 15.7681C21.3179 16.144 21.4956 16.4482 21.7212 16.6807C22.0151 16.9883 22.3091 17.2959 22.603 17.6035C22.9038 17.9111 23.1533 18.2256 23.3516 18.5469C23.5498 18.8682 23.6489 19.1997 23.6489 19.5415C23.6489 19.8423 23.5635 20.0918 23.3926 20.29L9.60107 6.47803C9.80615 6.31396 10.0249 6.16699 10.2573 6.03711C10.4966 5.90723 10.7495 5.79785 11.0161 5.70898C11.2075 5.03906 11.5596 4.47168 12.0723 4.00684C12.585 3.54199 13.2207 3.30957 13.9795 3.30957ZM4.52539 5.39111C4.375 5.24072 4.2998 5.05615 4.2998 4.8374C4.2998 4.61182 4.375 4.42383 4.52539 4.27344C4.68262 4.12305 4.87061 4.04785 5.08936 4.04785C5.31494 4.04785 5.50293 4.12305 5.65332 4.27344L24.0693 22.6792C24.2197 22.8296 24.2949 23.0142 24.2949 23.2329C24.2949 23.4517 24.2197 23.6396 24.0693 23.7969C23.9189 23.9473 23.731 24.0225 23.5054 24.0225C23.2866 24.0225 23.1021 23.9473 22.9517 23.7969L4.52539 5.39111Z"
                fill="white"
              />
            </svg>
          ) : null}
          {children}
        </div>
      </div>
    </div>
  );
};
